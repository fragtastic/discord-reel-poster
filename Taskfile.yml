# https://taskfile.dev

version: '3'

env:
  IMAGE_NAME: discord-reel-poster
  CURRENT_DATESTAMP:
    sh: date +"%Y%m%d%H%M%S"
  GIT_SHA:
    sh: git rev-parse HEAD

dotenv: ['.env']

tasks:
  run:
    cmds:
      - python main.py
    silent: true
  run-container:
    cmds:
      - podman run --rm --env-file=.env $IMAGE_NAME:latest
  build-container:
    cmds:
      - podman build -f Containerfile --build-arg COMMIT_SHA=$GIT_SHA -t $IMAGE_NAME:latest -t $IMAGE_NAME:$CURRENT_DATESTAMP .
